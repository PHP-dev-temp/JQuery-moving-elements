function createwt(){$("#wt-wrapper").html('<div id="wt-container"><div id="cmenu"></div></div><button id="wt-big">Add a table</button><button id="wt-small">Add a chair</button><button id="wt-save">Save</button></div>')}function newwt(){$("#wt-wrapper").html('<h2>New</h2> \t\t<input type="text" id="wt-name" name="wt-name" placeholder="Name of object" required /> \t\t<input type="number" id="wt-width" name="wt-width" placeholder="Enter width (m)" max="100" min="5" required /> \t\t<input type="number" id="wt-height" name="wt-height" placeholder="Enter height (m)" max="100" min="5" required /> \t\t<input type="submit" id="wt-submit" value="Submit"> \t\t<p></p> \t')}function showelement(t,e){$("#wt-container").append('<div id="element-'+t.id.toString()+'" class='+t.type+' style="width: '+(t.wtmeterw*e).toFixed(2).toString()+"px; height: "+(t.wtmeterh*e).toFixed(2).toString()+"px; top: "+(t.topm*e).toFixed(2).toString()+"px; left: "+(t.leftm*e).toFixed(2).toString()+'px;"></div>')}function gridcalculate(t,e){return grid=(t/e).toFixed(3),grid}function doResize(t){return t[0]?($("#wt-container").responsive(t[0].wtmeterw,t[0].wtmeterh),wtgrid=gridcalculate($("#wt-container").width(),t[0].wtmeterw),$("#wt-container").find("[id^=element]").each(function(){elementId=$(this).attr("id"),elementId.length&&0==elementId.indexOf("element-")&&(elementId=elementId.slice(8),$(this).responsiveElement(t[elementId],wtgrid))}),wtgrid):0}jQuery.fn.startwt=function(){$(this).html('<div id="wt-wrapper"><button id="new-wt">New</button><button id="open-wt">Open</button></div>')},jQuery.fn.dragelement=function(){var t,e,i,n,o,r,a,w=$(this),d=w.parent();return w.bind("mousedown",function(l){if(1==l.which){t=w.width(),e=w.height(),i=d.width(),n=d.height();var c=d.offset(),m=w.offset();o=l.pageX-m.left+c.left,r=l.pageY-m.top+c.top,a=!0}}),$(document).bind("mousemove",function(d){if(a){var l=i-t,c=n-e,m=d.pageX,s=d.pageY,p=m-o,u=s-r;p<0&&(p=0),u<0&&(u=0),p>l&&(p=l),u>c&&(u=c),w.css("top",u+"px"),w.css("left",p+"px")}}),$(window).bind("mouseup",function(t){a=!1}),this},jQuery.fn.responsive=function(t,e){thistarget=$(this),targetw=thistarget.width(),grid=gridcalculate(targetw,t),targeth=(e*grid).toString()+"px",thistarget.css({"background-size":grid.toString()+"px, "+grid.toString()+"px"}).height(targeth)},jQuery.fn.responsiveElement=function(t,e){thistarget=$(this),targetw=(t.wtmeterw*e).toFixed(3).toString()+"px",targeth=(t.wtmeterh*e).toFixed(3).toString()+"px",thistarget.width(targetw).height(targeth),targettop=(t.topm*e).toFixed(3).toString()+"px",targetleft=(t.leftm*e).toFixed(3).toString()+"px",thistarget.css({top:targettop,left:targetleft})},$(document).ready(function(){var t,e=0,i=[];$("#wt").startwt(),$(document).on("click","#new-wt",function(){newwt()}),$(document).on("click","#open-wt",function(){$.getJSON("data.json",function(e){for(item in e)i.push(e[item]);createwt(),$("#wt-container").responsive(i[0].wtmeterw,i[0].wtmeterh),t=gridcalculate($("#wt-container").width(),i[0].wtmeterw);for(var n=1;n<i.length;n++)showelement(i[n],t)})}),$(document).on("click","#wt-submit",function(){wtw=$("#wt-width").val(),wth=$("#wt-height").val(),wtw<5||wth<5||wtw>100||wth>100?$("#wt-wrapper>p").text("Please enter value between 5 and 100 (m)."):(i.push({wtmeterh:wth,wtmeterw:wtw,type:"wt",id:e}),e++,createwt(),$("#wt-container").responsive(wtw,wth),t=gridcalculate($("#wt-container").width(),i[0].wtmeterw))}),$(window).resize(function(){wtgridtemp=doResize(i),wtgridtemp&&(t=wtgridtemp)}),$(document).on("dblclick","[id^=element]",function(t){cmtop=parseInt($(this).css("top"),10)+20+"px",cmleft=parseInt($(this).css("left"),10)+20+"px",$("#cmenu").html('<ul><li><a data-action="move">move</a></li><li><a data-action="rotate">rotate</a></li><li><a data-action="resize">resize</a></li><li><a data-action="clone">clone</a></li><li><a data-action="close">close</a></li></ul>').css({top:cmtop,left:cmleft})}),$(document).on("mouseover","[id^=element]",function(){$(this).dragelement()}),$(document).on("mouseup","[id^=element]",function(){wtel=$(this),elementid=wtel.attr("id"),elementid.length&&0==elementid.indexOf("element-")&&(elementid=elementid.slice(8),i[elementid].topm=(parseInt(wtel.css("top"))/t).toFixed(3),i[elementid].leftm=(parseInt(wtel.css("left"))/t).toFixed(3))}),$(document).on("click","#wt-big",function(){i[e]={wtmeterh:1.6,wtmeterw:.8,type:"wt-table",id:e,topm:0,leftm:0},showelement(i[e],t),e++}),$(document).on("click","#wt-small",function(){i[e]={wtmeterh:.6,wtmeterw:.6,type:"wt-chair",id:e,topm:0,leftm:0},showelement(i[e],t),e++}),$(document).on("click","#wt-save",function(){jsonString=JSON.stringify(i),$.ajax({type:"POST",url:"phpajax.php",data:{data:jsonString},cache:!1}).done(function(t){alert("Ajax work!"),console.log(t)}).fail(function(t){alert("Ajax don't work!")})})});